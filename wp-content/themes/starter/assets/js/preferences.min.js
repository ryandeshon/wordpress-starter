!function(e){if(document.getElementById("pc-wrapper")){new function(i){e.extend(this,window.Newsletter.call(this,i)),this.subscribed=[];var n=this,a=e(".js-pref"),c=(e(".js-sub"),e(".js-field")),s=e(".js-email"),t=e('input[name="unsubscribe"]'),r={checked:[],fieldsChanged:[],email:null},l=function(){r.email=e(this).val()},u=function(){-1===e.inArray(this,r.checked)&&r.checked.push(this)},h=function(){-1===e.inArray(this,r.fieldsChanged)&&r.fieldsChanged.push(this)},d=function(){e(this).is(":checked")?(n.subscribed=[],e("input.js-sub").each(function(i,a){e(a).is(":checked")&&n.subscribed.push(e(a))}),e("input.js-sub").removeAttr("checked")):e.each(n.subscribed,function(e,i){i.prop("checked",!0)})};this.form=e(i).find('form[name="preference"]'),this.formSubmission=function(i){if(!n.clicked){var a;n.clicked=!0,n.errorEl.hide(),n.confirmation.hide();var c={};e(".js-sub").each(function(i,n){var a=e(this).is(":checked")?"1":"0",s=e(this).val();c[s]=a}),e(".js-sub:checked").length<=0&&(a=!0),e.each(r.fieldsChanged,function(i,n){var a=e(this).attr("id"),c=e(this).val();r.fieldsChanged[i]=a+"="+c});var s=n.form.find('input[name="ajaxurl"]').val(),t=n.form.find('input[name="nonce"]').val(),l=n.form.find('input[name="guid"]').val(),u={email:r.email,oldEmail:r.oldEmail,nonce:t,action:"preference_center",guid:l,refurl:encodeURI(document.location.href),subscriptions:c,preferences:r.checked,fields:r.fieldsChanged,unsubscribed:a};n.submitForm(s,u)}},this.init=function(){r.oldEmail=this.form.find("#Email").val(),a.on("change",u),c.on("change",h),s.on("change",l),t.on("click",d),new FormValidator("preference",[{name:"Email",rules:"valid_email"},{name:"FirstName",rules:"alpha",display:"First Name"},{name:"Bm",rules:"numeric|max_length[2]"},{name:"Bd",rules:"numeric|max_length[2]"},{name:"State",rules:"alpha|max_length[2]"},{name:"Pc",rules:"alpha_numeric"}],function(i,a){i.length>0?e.each(i,function(i,n){e(n.element).next(".help-block").html(n.message)}):(a.preventDefault(),n.formSubmission())})}}(document.getElementById("pc-wrapper")).init()}}(jQuery);